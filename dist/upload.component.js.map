{"version":3,"sources":["upload.component.ts"],"names":[],"mappings":"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","file":"upload.component.js","sourcesContent":["/// <reference path=\"../typings/index.d.ts\"/>\nimport * as angular from 'angular';\nimport 'angular-material';\n//docs https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/angular-material/angular-material.d.ts#L30\n\n// noinspection TypeScriptCheckImport\nimport {dirname} from 'decaf-common';\nimport './upload.component.css!';\nimport uploadService, {UploadService} from './upload.service';\n\n\nexport const COMPONENT_NAME = 'upload';\nconst upload = angular.module(COMPONENT_NAME, [\n\tuploadService.name\n]);\n\nupload.config(function (platformProvider) {\n\tplatformProvider\n\t\t.register(COMPONENT_NAME)\n\t\t.state(COMPONENT_NAME, {\n\t\t\turl: `/${COMPONENT_NAME}`,\n\t\t\tviews: {\n\t\t\t\t'content@': {\n\t\t\t\t\ttemplateUrl: `${dirname(module.id)}/upload.component.html`,\n\t\t\t\t\tcontroller: UploadController,\n\t\t\t\t\tcontrollerAs: 'UploadController'\n\t\t\t\t}\n\t\t\t}\n\t\t});\n});\n\nclass UploadController {\n\tisWaiting: boolean;\n\tuploadService: UploadService;\n\tdata: any;\n\texpectedFields: any[];\n\tprojects: any[];\n\tselected_project: string;\n\tprivate $mdDialog: angular.material.IDialogService;\n\tprivate $timeout: angular.ITimeoutService;\n\tprivate $sce: angular.ISCEService;\n\n\tconstructor($timeout, $sce, $mdDialog, UploadService:UploadService) {\n\t\tthis.uploadService = UploadService;\n\t\tthis.$timeout = $timeout;\n\t\tthis.$sce = $sce;\n\t\tthis.$mdDialog = $mdDialog;\n\t\tthis.isWaiting = false;\n\t\tthis.expectedFields = [];\n\t\tthis.projects = [];\n\t\tthis.data = {\n\t\t\tmedia: {\n\t\t\t\tfiles: {media: ''}, status: 'na', what: 'media', order: ['media']\n\t\t\t},\n\t\t\tstrains: {\n\t\t\t\tfiles: {strains: ''}, status: 'na', what: 'strains', order: ['strains']\n\t\t\t},\n\t\t\tfermentation: {\n\t\t\t\tfiles: {sample_information: '', physiology: ''},\n\t\t\t\tstatus: 'na',\n\t\t\t\twhat: 'fermentation',\n\t\t\t\torder: ['sample_information', 'physiology'],\n\t\t\t},\n\t\t\tscreen: {\n\t\t\t\tfiles: {screen: ''}, status: 'na', what: 'screen', order: ['screen']\n\t\t\t}\n\t\t};\n\t\tthis.getProjects();\n\t\tthis.selected_project = '';\n\t}\n\n\tgetSchema(inputFile) {\n\t\tthis.expectedFields = [];\n\t\tthis.uploadService.getSchema(inputFile)\n\t\t\t.then((data: any) => {\n\t\t\t\tdata.data.fields.forEach((value) => {\n\t\t\t\t\tthis.expectedFields.push(value)\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tgetProjects() {\n\t\tthis.uploadService.getProjects()\n\t\t\t.then((data:any) => {\n\t\t\t\tdata.data.forEach((value) => {\n\t\t\t\t\tthis.projects.push(value)\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tshowHelpAlert(inputFile) {\n\t\tthis.getSchema(inputFile);\n\t\tthis.$mdDialog.show({\n\t\t\ttemplateUrl: 'dialog-template.html',\n\t\t\tparent: angular.element(document.querySelector('#popupContainer')),\n\t\t\tclickOutsideToClose: true,\n\t\t\tlocals: {\n\t\t\t\texpectedFields: this.expectedFields,\n\t\t\t\tinputFile: inputFile\n\t\t\t},\n            controller($scope, $mdDialog: ng.material.IDialogService, expectedFields, inputFile) {\n\t\t\t\t$scope.expectedFields = expectedFields;\n\t\t\t\t$scope.inputFile = inputFile;\n                $scope.close = () => {\n                    $mdDialog.hide();\n                };\n            }\n\t\t});\n\t}\n\n\tsetFile(file, what, which) {\n\t\tthis.data[what].files[which] = file;\n\t}\n\n\tclear() {\n\t\tfor (var what in this.data) {\n\t\t\tif (this.data.hasOwnProperty(what)) {\n\t\t\t\tfor (var key in this.data[what].files) {\n\t\t\t\t\tif (this.data[what].files.hasOwnProperty(key)) {\n\t\t\t\t\t\tthis.data[what].files[key] = '';\n\t\t\t\t\t\tthis.data[what].status = 'na';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildFileList(what) {\n\t\tvar fileList = [];\n\t\tfor (var i = 0; i < this.data[what].order.length; i++) {\n\t\t\tif (this.data[what].files[this.data[what].order[i]]) {\n\t\t\t\tfileList.push(this.data[what].files[this.data[what].order[i]]);\n\t\t\t}\n\t\t}\n\t\treturn fileList;\n\t}\n\n\tsubmit() {\n\t\tfor (var what in this.data) {\n\t\t\tif (this.data.hasOwnProperty(what)) {\n\t\t\t\tvar fileList = this.buildFileList(what);\n\t\t\t\tif (fileList.length === this.data[what].order.length) {\n\t\t\t\t\tthis.isWaiting = true;\n\t\t\t\t\tthis.data[what].status = 'na';\n\t\t\t\t\tvar data = {file: fileList, what: what, project_id: this.selected_project};\n\t\t\t\t\tthis.uploadService.uploadFile(data)\n\t\t\t\t\t\t.then(function (what, ref) {\n\t\t\t\t\t\t\t\treturn function (response) {\n\t\t\t\t\t\t\t\t\tref.isWaiting = false;\n\t\t\t\t\t\t\t\t\tref.data[what].response = response.data;\n\t\t\t\t\t\t\t\t\t// console.log(response.data.valid);\n\t\t\t\t\t\t\t\t\tif (response.data.valid) {\n\t\t\t\t\t\t\t\t\t\tref.data[what].status = 'ok';\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tref.data[what].status = 'ng';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}(what, this),\n\t\t\t\t\t\t\t// error\n\t\t\t\t\t\t\t([status, dataResponse]) => {\n\t\t\t\t\t\t\t\t// console.log(status);\n\t\t\t\t\t\t\t\t// console.log(dataResponse);\n\t\t\t\t\t\t\t\tthis.isWaiting = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport default upload;\n"]}